<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaflet Map with Monumental Houses</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 400px; }
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: #333;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>
  <div id="map"></div>

  <script>

var map = L.map('map').setView([51.9, 4.5], 7);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  // Fetch data from the API
  fetch('https://api.linkeddata.cultureelerfgoed.nl/queries/rce/Query-6-1-1-1-2-1/3/run?')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      console.log(data); // Log the fetched data to the console for inspection
      if (!data.results) {
        throw new Error('Invalid data format: Missing "results" property');
      }
      data.results.forEach(function(binding) {
        // Extract coordinates
        var shape = binding.shape.value;
        var coordinates = parseCoordinates(shape);

        // Extract additional information
        var name = binding.shapeLabel.value;

        // Create marker and add it to the map
        var marker = L.marker(coordinates).addTo(map);
        marker.bindPopup(name);
      });
    })
    .catch(error => {
      console.error('Error fetching data:', error);
    });

  // Function to parse WKT coordinates for polygons and multipolygons
  function parseCoordinates(wkt) {
    // Implementation of parseCoordinates() function remains unchanged
  }


  
    // Function to parse WKT coordinates
// Function to parse WKT coordinates for polygons and multipolygons
function parseCoordinates(wkt) {
  var regex = /\d+\.\d+/g;
  var matches = wkt.match(regex);
  
  // Check if it's a multipolygon
  if (matches.length % 2 !== 0) {
    var coordinates = [];
    var currentPolygon = [];
    for (var i = 0; i < matches.length; i += 2) {
      var lat = parseFloat(matches[i]);
      var lng = parseFloat(matches[i + 1]);
      currentPolygon.push([lat, lng]);
      if (i > 0 && lat === parseFloat(matches[0]) && lng === parseFloat(matches[1])) {
        // End of current polygon, add to coordinates array and start a new polygon
        coordinates.push(currentPolygon);
        currentPolygon = [];
      }
    }
    return coordinates;
  } else {
    // Single polygon, return as a single array
    var coordinates = [];
    for (var i = 0; i < matches.length; i += 2) {
      var lat = parseFloat(matches[i]);
      var lng = parseFloat(matches[i + 1]);
      coordinates.push([lat, lng]);
    }
    return coordinates;
  }
}

  </script>
  
</body>
</html>
